<!DOCTYPE html>
<html lang="en">

<head>
    <title>Shoping Cart</title>
    <link href="/images/logo final 2.jpeg" rel="icon">
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- Mobile Metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <link rel="stylesheet" type="text/css" href="/users/css/bootstrap.css" />
    <!-- Site Metas -->
    <!-- font awesome style -->
    <link href="/users/css/font-awesome.min.css" rel="stylesheet" />
    <!-- Custom styles for this template -->
    <link href="/users/css/style.css" rel="stylesheet" />
    <!-- responsive style -->
    <link href="/users/css/responsive.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">



    <!--===============================================================================================-->

    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="/productDetails/vendor/bootstrap/css/bootstrap.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="/productDetails/fonts/font-awesome-4.7.0/css/font-awesome.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="/productDetails/fonts/iconic/css/material-design-iconic-font.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="/productDetails/fonts/linearicons-v1.0.0/icon-font.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="/productDetails/vendor/animate/animate.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="/productDetails/vendor/css-hamburgers/hamburgers.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="/productDetails/vendor/animsition/css/animsition.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="/productDetails/vendor/select2/select2.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="/productDetails/vendor/perfect-scrollbar/perfect-scrollbar.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="/productDetails/css/util.css">
    <link rel="stylesheet" type="text/css" href="/productDetails/css/main.css">
    <!--===============================================================================================-->
</head>

<body class="animsition">

    <!-- Header -->
    <header class="header_section" style="background-color: #427677;">
        <div class="container" style="background-color: #427677;">
            <nav class="navbar navbar-expand-lg custom_nav-container ">
                <a class="navbar-brand" href="/"><img width="250"
                        src="/images/logo_final_2-removebg-preview-removebg-preview (2).png" alt="#"></a>
                <button class="navbar-toggler" type="button" data-toggle="collapse"
                    data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span class=""> </span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav">
                        <% categories.forEach(function(category){%>
                            <% if (category.status) { %>
                                <li class="nav-item">
                                    <a class="nav-link px-2"
                                        href="/spectacular/<%=category.categoryname%>/<%= category._id %> ">
                                        <%= category.categoryname %>
                                    </a>
                                </li>
                                <% } %>
                                    <% }) %>

                                        <% if(session){ %>
                                            <li class="nav-item">
                                                <a class="nav-link px-1" href="/cart/<%=session._id %>">
                                                    <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg"
                                                        xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                                                        viewBox="0 0 456.029 456.029"
                                                        style="enable-background:new 0 0 456.029 456.029;"
                                                        xml:space="preserve">
                                                        <g>
                                                            <g>
                                                                <path
                                                                    d="M345.6,338.862c-29.184,0-53.248,23.552-53.248,53.248c0,29.184,23.552,53.248,53.248,53.248
                                         c29.184,0,53.248-23.552,53.248-53.248C398.336,362.926,374.784,338.862,345.6,338.862z" />
                                                            </g>
                                                        </g>
                                                        <g>
                                                            <g>
                                                                <path d="M439.296,84.91c-1.024,0-2.56-0.512-4.096-0.512H112.64l-5.12-34.304C104.448,27.566,84.992,10.67,61.952,10.67H20.48
                                         C9.216,10.67,0,19.886,0,31.15c0,11.264,9.216,20.48,20.48,20.48h41.472c2.56,0,4.608,2.048,5.12,4.608l31.744,216.064
                                         c4.096,27.136,27.648,47.616,55.296,47.616h212.992c26.624,0,49.664-18.944,55.296-45.056l33.28-166.4
                                         C457.728,97.71,450.56,86.958,439.296,84.91z" />
                                                            </g>
                                                        </g>
                                                        <g>
                                                            <g>
                                                                <path
                                                                    d="M215.04,389.55c-1.024-28.16-24.576-50.688-52.736-50.688c-29.696,1.536-52.224,26.112-51.2,55.296
                                         c1.024,28.16,24.064,50.688,52.224,50.688h1.024C193.536,443.31,216.576,418.734,215.04,389.55z" />
                                                            </g>
                                                        </g>
                                                        <g>
                                                        </g>
                                                        <g>
                                                        </g>
                                                        <g>
                                                        </g>
                                                        <g>
                                                        </g>
                                                        <g>
                                                        </g>
                                                        <g>
                                                        </g>
                                                        <g>
                                                        </g>
                                                        <g>
                                                        </g>
                                                        <g>
                                                        </g>
                                                        <g>
                                                        </g>
                                                        <g>
                                                        </g>
                                                        <g>
                                                        </g>
                                                        <g>
                                                        </g>
                                                        <g>
                                                        </g>
                                                        <g>
                                                        </g>
                                                    </svg>
                                                </a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link dropdown-toggle-none d-flex px-1" id="userDropdown"
                                                    role="button" data-toggle="dropdown" aria-haspopup="true"
                                                    aria-expanded="false">
                                                    <i class="material-icons"
                                                        style="font-size:1.5rem;color:black">person</i>
                                                </a>
                                                <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in  "
                                                    aria-labelledby="userDropdown">
                                                    <a class="dropdown-item" href="/profile/<%=session._id%>">
                                                        Profile
                                                    </a>
                                                </div>
                                            </li>
                                            <% }else{ %>
                                                <li class="nav-item dropdown">
                                                    <a class="nav-link px-1 " href="/signin"
                                                        style="color: black;">LogIn</a>
                                                </li>
                                                <% } %>
                    </ul>
                </div>
            </nav>
        </div>
    </header>
    <!--================Checkout Area =================-->

    <div class="container">

        <div class="row">


            <div class="bor10 p-lr-40 p-t-30 p-b-40 m-l-63 m-r-40 m-lr-0-xl p-lr-15-sm">
                <h4 class="mtext-109 cl2 p-b-30">
                    Cart Totals
                </h4>


                <div class="flex-w flex-t bor12 p-b-13">
                    <div class="size-208">
                        <span class="stext-110 cl2">
                            Subtotal:
                        </span>
                    </div>

                    <div class="size-209">
                        <span class="mtext-110 cl2">
                            RS <%= sum %> /-
                        </span>
                    </div>
                </div>

                <div class="flex-w flex-t bor12 p-t-15 p-b-30">
                    <div class="size-208 w-full-ssm">
                        <span class="stext-110 cl2">
                            Shipping:
                        </span>
                    </div>


                    <div class="size-209 p-r-18 p-r-0-sm w-full-ssm ">
                        <div class="d-flex justify-content-between">
                            <p class="stext-111 cl6 p-t-2">
                                Please select Your ADDRESS
                            </p>
                            <div class="col">
                                <a href="javascript:void(0);" data-toggle="modal" data-target="#addAddress"><button
                                        type="button" class="btn btn-outline-dark"
                                        style="font-size: 1rem;padding: 2px;">Add Address</button></a>
                            </div>
                        </div>
                    </div>
                    <form id="placeOrder">


                        <div class="p-t-15">
                            <div class="rs1-select2 rs2-select2 bor8 bg0 m-t-9">
                                <select class="js-select2" name="address">
                                    <%for( let i=0;i<userData.address.length;i++){ %>
                                        <option>
                                            <%= (i+1) %> . <%= userData.address[i].name %>,<%=
                                                        userData.address[i].housename %>,<%= userData.address[i].place
                                                            %> , <%= userData.address[i].post %> , <%=
                                                                    userData.address[i].dist %> , <%=
                                                                        userData.address[i].state %>
                                                                        ,Pincode : <%= userData.address[i].pin %>
                                                                            ,Phone
                                                                            No. <%= userData.address[i].phone%>
                                        </option>
                                        <% } %>
                                </select>
                                <div class="dropDownSelect2"></div>


                            </div>
                        </div>


                        <div class="flex-w flex-t bor12 p-t-15 p-b-30">
                            <div class="size-208 w-full-ssm">
                                <span class="stext-110 cl2">
                                    Payment:
                                </span>


                                <div class="d-block my-3" style="margin-left: 20rem;">
                                    <div class="custom-control custom-radio ">
                                        <input id="credit" name="paymentMethod" type="radio" value="COD"
                                            class="custom-control-input" checked required />
                                        <label class="custom-control-label" for="credit">COD</label>
                                    </div>
                                    <div class="custom-control custom-radio">
                                        <input id="debit" name="paymentMethod" type="radio" value="Online"
                                            class="custom-control-input" required />
                                        <label class="custom-control-label" for="debit">Online</label>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <div class="flex-w flex-sb-m bor15 p-t-18 p-b-15 p-lr-40 p-lr-15-sm">
                            <div class="flex-w flex-m m-r-20 m-tb-5">
                                <input type="text" class="form-control" id="coupon" aria-describedby="coupon"
                                    placeholder="Enter Coupon" name="coupon">

                            </div>
                        </div>

                        <div class="flex-w flex-t p-t-27 p-b-33">
                            <div class="size-208">
                                <span class="mtext-101 cl2">
                                    Total:
                                </span>
                            </div>

                            <div class="size-209 p-t-1">
                                <span class="mtext-110 cl2">
                                    Rs <%= sum %> /- </span>
                            </div>
                        </div>
                </div>
            </div>
            <button type="submit" class="flex-c-m stext-101 cl0 size-116 bg3 bor14 hov-btn3 p-lr-15 trans-04 pointer">
                Order Confirm
            </button></a>
        </div>

        </form>
    </div>
    </div>
    <!--================End Checkout Area =================-->
    <!-- Modal addAddress -->
    <div class="modal fade" id="addAddress" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabelLogout"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabelLogout">Add Address</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form action="/addaddress/<%= session._id %>" method="post">
                    <div class="modal-body">
                        <p>Please enter the details </p>

                        <div class="form-wrapper">
                            <input type="text" placeholder="Name" name="name" class="form-control">
                        </div>
                        <div class="form-wrapper">
                            <input type="text" placeholder="HouseName" name="housename" class="form-control">
                        </div>
                        <div class="form-wrapper">
                            <input type="text" placeholder="Place" name="place" class="form-control">
                        </div>
                        <div class="form-wrapper">
                            <input type="text" placeholder="Post" name="post" class="form-control">
                        </div>
                        <div class="form-wrapper">
                            <input type="text" placeholder="District" name="dist" class="form-control">
                        </div>
                        <div class="form-wrapper">
                            <input type="text" placeholder="State" name="state" class="form-control">
                        </div>
                        <div class="form-wrapper">
                            <input type="number" placeholder="Pincode" name="pin" class="form-control">
                        </div>
                        <div class="form-wrapper">
                            <input type="number" placeholder="Phone Number" name="phone" class="form-control">
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-primary" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-outline-primary">ADD</button>
                    </div>
                </form>
            </div>
        </div>
    </div>





   <!--===============================================================================================-->
   <script src="/productDetails/vendor/isotope/isotope.pkgd.min.js"></script>
   <!--===============================================================================================-->
   <script src="/productDetails/vendor/sweetalert/sweetalert.min.js"></script>
    <!--===============================================================================================-->
    <script src="/productDetails/vendor/jquery/jquery-3.2.1.min.js"></script>
    <!--===============================================================================================-->
    <script src="/productDetails/vendor/animsition/js/animsition.min.js"></script>
    <!--===============================================================================================-->
    <script src="/productDetails/vendor/bootstrap/js/popper.js"></script>
    <script src="/productDetails/vendor/bootstrap/js/bootstrap.min.js"></script>
    <!--===============================================================================================-->
    <script src="/productDetails/vendor/select2/select2.min.js"></script>
    <script>
        $(".js-select2").each(function () {
            $(this).select2({
                minimumResultsForSearch: 20,
                dropdownParent: $(this).next('.dropDownSelect2')
            });
        })
    </script>

    <!--===============================================================================================-->
    <script src="/productDetails/vendor/MagnificPopup/jquery.magnific-popup.min.js"></script>
    <!--===============================================================================================-->
    <script src="/productDetails/vendor/perfect-scrollbar/perfect-scrollbar.min.js"></script>
    <script>
        $('.js-pscroll').each(function () {
            $(this).css('position', 'relative');
            $(this).css('overflow', 'hidden');
            var ps = new PerfectScrollbar(this, {
                wheelSpeed: 1,
                scrollingThreshold: 1000,
                wheelPropagation: false,
            });

            $(window).on('resize', function () {
                ps.update();
            })
        });
    </script>
    <!--===============================================================================================-->
    <script src="/productDetails/js/main.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>

    $("#placeOrder").submit((e) => { 
    e.preventDefault();
    $.ajax({
      url: '/placeOrder',
      method: 'post',
      data: $('#placeOrder').serialize(),
      success: (response) => {
        if (response.couponDeleted) {
          swal({
            title: "coupon no longer exist!",
            icon: "error",
            confirmButtonText: "continue",
          }).then(function () {
            location.reload();
          });
        } else if (response.coupon) {
          swal({
            title: "Coupon already used!",
            icon: "error",
            confirmButtonText: "continue",
          }).then(function () {
            location.reload()
          });
        } else if (response.invalid) {
          swal({
            title: "Invalid Coupon",
            icon: "error",
            confirmButtonText: "continue",
          }).then(function () {
            location.reload();
          });
        }
         else  if (response.success){
            location.href = "/orderSuccess"
        } else {
          razorPay(response.order);
        }
      }
    })
  }) 
  function razorPay(order) {
    console.log(order);
    var options = {
      "key": 'rzp_test_qq5bQRHAjQkl9N',
      "amount": order.amount,
      "currency": "INR",
      "name": "Spectacular E-store",
      "description": "Test Transaction",
      "image": "/images/logo final 2.jpeg",
      "order_id": order.id,
      "handler": function (response) {

        verifyPayment(response, order);
      },
      "prefill": {
        "name": "Spectacular E-store",
        "email": "spectacular6776@gmail.com",
        "contact": "9898989898"
      },
      "notes": {
        "address": "Razorpay Corporate Office"
      },
      "theme": {
        "color": "#FBF0F3"
      }
    };
    var rzp1 = new Razorpay(options);
    rzp1.on("payment.failed", function(response) {
      Swal.fire({
        title: "Payment failed!, Try again",
        icon: "error",
        confirmButtonText: "continue",
      })
    });
    rzp1.open();
  }

  function verifyPayment(payment, order) {
    $.ajax({
      url: "/verifyPayment",
      data: {
        payment,
        order,
      },
      method: "post",
      success: (response) => {
        if (response.success) {
          location.href = "/orderSuccess";
        } else {
            Swal.fire({
            title: "Payment failed!, Try again",
            icon: "error",
            confirmButtonText: "continue",
          })        
        }
      },
    });
  }
    </script>


</body>

</html>